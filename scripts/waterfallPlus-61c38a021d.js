!function(t){function e(t){console.log("waterfall执行");var e=document.getElementById(t),n=e.children,i=n[0].offsetWidth;console.log("picW",i);var l=Math.floor(o().width/i);e.style.cssText="width:"+i*l+"px;";for(var d=[],a=0;a<n.length;a++){var c=n[a].offsetHeight;if(a<l)d[a]=c;else{console.log(" pinHArr",d);var r=Math.min.apply(null,d),s=d.indexOf(r);n[a].style.position="absolute",n[a].style.top=r+"px",n[a].style.left=n[s].offsetLeft+"px",d[s]+=n[a].offsetHeight}}}function n(t){var e=(t=document.getElementById(t)).children,n=e[e.length-1].offsetHeight,l=i().top,d=o().height;return n-d<l+d}function o(){return window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:"CSS1Compat"==document.compatMode?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.body.clientWidth,height:document.body.clientHeight}}function i(){return null!=window.pageYOffset?{left:window.pageXOffset,top:window.pageYOffset}:"CSS1Compat"==document.compatMode?{left:document.documentElement.scroll,top:document.documentElement.scroll}:{left:document.body.scrollLeft,top:document.body.scrollTop}}var l=!1,d=window.addEventListener?function(t,e,n){t.addEventListener(e,n)}:window.attachEvent?function(t,e,n){t.attachEvent(e,n)}:function(t,e,n){t["on"+e]=n};d(window,"scroll",function(){if(!l&&(l=!0,n("itemParent"))){console.log("还在请求");var t=new XMLHttpRequest;t.open("post","./api/waterfall.php"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==t.readyState&&(t.status>=200&&t.status<300||304==t.status)){var n=t.responseText,o={item:n=JSON.parse(n)},i=template("template",o);itemParent.innerHTML+=i,e("itemParent"),l=!1}},t.send()}}),d(window,"load",function(){console.log("加载完成"),e("itemParent")}),e("itemParent"),t.waterfall=e}(window);